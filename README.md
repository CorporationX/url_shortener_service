# URL shortener service

## Обзор
**URL Shortener Service** - это микросервис, который позволяет пользователю связать его длинную реферальную ссылку с коротким хэшом, 
который создаётся на стороне сервера.

## Особенности
Функция сервиса - это генерация уникального хэша и связывание его с пользовательской длинной ссылкой. В процессе решения этой задачи были
использованы некоторые подходы для увеличения скорости обработки запросов и снижения нагрузки на базу данных.

- **Хэши создаются заблаговременно и хранятся в БД.**  
  - Хэш - это закодированное число по алгоритму **B62**, не превышающей 6 символов(более чем достаточно). Число уникально, поскольку генерируется в БД (sequence). 
  - Чтобы не обращаться в БД каждый раз за новым числом для будущего хэша, по запросу возвращается последовательность, состоящая из большого количества чисел.
  - Метод обращающийся за последовательностью в БД, кодирующий числа и сохраняющий хэши, вызывается по расписанию. Но если хэши закончились в БД, то метод будет вызван.
- **Кэширование списка хэшей.**  
  - Чтобы снизить количество обращений к БД с хэшами, часть этих хэшей хранятся в `Map` в приложении. 
  - Если размер `Map` снижается ниже порогового значения (в %), то программа асинхронно обращается к БД для пополнения `Map`.
  - Если произошёл сбой, и потребовалось перезагрузить сервис, то прежде чем программа начнёт обрабатывать запросы на выдачу хэшей, она заполнит `Map` не асинхронно (прогрев кэша).
- **Выданный hash кэшируется с помощью redis на ttl времени.**  
  - Ожидается, что основной интерес к реферальной ссылке будет в первые часы её создания, в связи с чем пользователю будет 
  возвращена длинную ссылку, хранящаяся в оперативной памяти, минуя запрос в БД.
- **Удаление hash с истекшей датой**  
  - По расписанию программа будет удалять из таблицы url записи, сохраняя при этом hash для последующего переиспользования.